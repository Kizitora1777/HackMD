###### tags: `卒業研究`

# 卒業論文 アウトライン

5409 遠藤 拓斗

## タイトル

+ 準同型除算によるプライバシ保護ニューラルネットワーク

## 第1章 はじめに

+ 研究背景
    + Machine Learning as a Service (MLaas) の台頭とプライバシー保護機械学習 (PPML) の意義
        + MLaasの説明
            + 機械学習をクラウド上で行う
            + 具体的なサービス名の提示
        + PPMLが必要となる理由の説明
            + 機密データを信頼できない第三者のクラウド上に預ける際の情報漏洩のリスク
            + 具体例として医療データ・金融データを提示
        + PPMLの実現方法
            + 秘匿マルチパーティ計算と完全準同型暗号の二種類がある
            + 今回は完全準同型暗号を使用する
+ 最終目標
    + PPMLの推論精度の向上
        + 現在の推論精度の説明
            + 小さいデータセットでは問題なく推論できるが、大きなデータセットになると精度が落ちる
            + 具体例としてMNIST, CIFAR-10 を提示
+ 現状
    + しかし、PPMLのニューラルネットワークにおいて、活性化関数を近似する必要があるため、近似誤差による精度低下が懸念される
        + ニューラルネットワークと活性化関数の説明
            + どうしてこの2つが必要となるのか？が分かる程度にとどめる
            + 詳細な説明は避ける
        + 近似する理由について説明
            + 完全準同型暗号で効率的に実行できる演算は「加算」と「乗算」のみ
            + そのため、関数そのものを多項式近似する
        + 近似誤差による精度低下
            + 活性化関数をそのまま近似できているわけではないため、平文データよりも精度が下がる
+ 課題
    + 活性化関数を近似せずに実行できるようにすることで、精度の低下を避ける
        + 近似誤差が無くなることで、精度の向上へつながる
        + 直接近似する場合、$x = 0$から離れるほど誤差が大きくなる
        + もし演算を直接実行できれば、どのx座標でもシグモイド関数の値を計算できるため、上記のような問題は起きない
        + 本研究では活性化関数のなかでもシグモイド関数をターゲットとする
+ 問題
    + シグモイド関数を直接近似しない場合、除算・指数関数を加算と乗算のみで実現する必要がある
        + 簡単なシグモイド関数の説明
        + 加算と乗算のみで構成する
+ 目的
    + そこでシグモイド関数に必要な準同型除算を多項式補間を用いて提案し、関数を部分的に実現する
        + 指数関数については先行研究で提案されている
        + 準同型除算の説明
        + 準同型除算を用いたシグモイド関数は、先行研究でも提案されていない
            + 準同型除算の説明を簡単にする
            + 先行研究は直接近似する手法を使っている
        + 関連研究の話
            + 直接近似 CryptoDL, PPML ResNet20, Sealion
            + 除算：ゴールドシュミット除算
+ 目標
    + 具体的には、① 指数関数を近似し、② 除算の近似手法を新たに提案し、③ ①と②でシグモイド関数を構成する
        + シグモイド関数に必要な演算は除算と指数関数の2つ。これらをFHEで実行することを目指す

+ 手段
    + そのためには、① 先行研究の手法を採用し、② スケーリングしたうえで多項式補間で近似して、③ ①と②を用いて構成する
        + 指数関数の近似手法はすでに提案されている
        + 除算についても指数関数と同様のアプローチで近似する（本研究で新たに提案した部分）

## 第2章 周辺技術

+ ニューラルネットワーク
+ 活性化関数
+ 公開鍵暗号
+ 準同型暗号
+ 完全準同型暗号
+ CKKS
+ HELib
+ 多項式補間

## 第3章 提案手法

### 3.1 指数関数の近似手法

+ 先行研究の提案手法の概要
    + 入力値をスケーリングして一定の範囲に抑え、その部分を近似する
        + 入力値を$B$で割ることで$[-1, 1]$の範囲に抑える
        + $y = \exp(x) \ \{-1 \leq x \leq 1\}$ の多項式近似
+ 疑似コードの提示と説明
    + 既に書いたものを使う

### 3.2 除算の近似手法

+ 今回新たに提案した近似手法の概要
    + 入力値をスケーリングして一定の範囲に抑え、その部分を近似する
        + 入力値を$R$で割ることで$[1, 10]$の範囲に抑える
        + $y = \frac{1}{x} \ \{1 \leq x \leq 10 \}$ の多項式近似
+ 疑似コードの提示と説明
    + 既に書いたものを使う

### 3.3 シグモイド関数の構成

+ アルゴリズム
    + 3.1の指数関数と3.2の除算による構成を説明する

## 第4章 実験と評価

+ 各節のあらまし
    + 4.1節
        + 近似性能に関する実験
        + 演算の近似結果(グラフ)
        + 最小二乗誤差(表)
    + 4.2節
        + 同上
    + 4.3節
        + 提案手法の性能に関する説明
        + 計算量の解析結果
        + 推論精度の結果

### 4.1 指数関数の結果

+ 結果の図の名称と構造
    + 真値-近似値の比較グラフ
        + 真値　：$y = \exp(-x)$
        + 近似値：$y = \mathrm{HEexp}(-x)$
        + 横軸：入力値 $x \ [-4, 4]$
        + 縦軸：指数関数の出力値 $y$
        + グラフ(イメージ) <img src="https://i.imgur.com/rvze7hy.png" width="70%">
    + 真値-近似値の比較表
        + 入力値 $x \ [-4, 4]$ で0.2刻み
        + $x$ ごとの真値と近似値
        + 表(イメージ)

| $x$ | 真値 | 近似値 |
| --------: | --------: | --------: |
| -4.0   | 0.0183156 | 0.0183901 |
| -3.8 | 0.0223707 | 0.0224555 |
| -3.6 | 0.0273237 | 0.0274176 |
| $\vdots$ | $\vdots$ | $\vdots$ |


+ 知見の得方
    + グラフ：近似値が真値にどの程度近いかを視覚的に確認する
    + 表：真値と近似値の相対誤差を計算する
+ 得られた知見
    + 真値と近似値の相対誤差より、どの程度の精度で近似できたかを確認する
    + 先行研究の通りに実現できた

### 4.2 除算の結果

+ 結果の図の名称と構造
    + 真値-近似値の比較グラフ
        + 真値　：$y = \frac{1}{x}$
        + 近似値：$y = \mathrm{HEinverse}(-x)$
        + 横軸：入力値 $x \ [1, 10]$
        + 縦軸：除算の出力値 $y$
        + グラフ(イメージ) <img src="https://i.imgur.com/rvze7hy.png" width="70%">
    + 真値-近似値の比較表
        + 入力値 $x \ [1, 10]$ で0.5刻み
        + $x$ ごとの真値と近似値
        + 表(イメージ)

| $x$ | 真値 | 近似値 |
| --------: | --------: | --------: |
| 1.0   | 1 | 1 |
| 1.5 | 0.66666 | 0.678593 |
| 2.0 | 0.5 | 0.501753 |
| $\vdots$ | $\vdots$ | $\vdots$ |

+ 知見の得方
    + グラフ：近似値が真値にどの程度近いかを視覚的に確認する
    + 表：真値と近似値の相対誤差を計算する
+ 得られた知見
    + 真値と近似値の相対誤差より、どの程度の精度で近似できたかを確認する
    + 除算$y = 1/x$を高精度で近似できる
    + $1 \leq x$ の値の逆数を求められる
    + 多項式補間を整数から実数へ拡張できる

### 4.3 シグモイド関数の結果

+ 図表
    + 数式：乗算の深さ - オーダー記法
    + 表：CryptoDLを用いた暗号データに対する推論結果
        + CryptoDLの話
        + 学習時点の精度の話
        + 表(イメージ)

| 活性化関数 | 従来手法 | 提案手法 |
| :----------: | ------: | ------: |
| シグモイド関数 | 0.0947266 | 0.107422 |

+ 知見の得方
    + 平文データに対するシグモイド関数と近似式の精度の違い
    + オーダー記法をもとに計算量(乗算の深さ)を読み取る
        + ざっと求めた感じ $O(\log p (\log p +log B))$
            + $\log p$：pow(x) (inverse)
            + + $\log p$：pow(x) (exp)
            + + $\log B$：$\exp(x/B)^B$ (exp)
        + 乗算の深さに関する説明をする([URL1 5.1.1](https://drive.google.com/file/d/19lC1QtY4h5cSjV7dQNHGNrVVbW7pZ4H-/view), [URL2, 3.3.1](https://drive.google.com/file/d/1v1c5Jy9ZTMUpfSSXob4fIVdfx9wrWQhp/view)を参考に)
+ 得られた知見
    + 精度結果より従来手法と提案手法の比較(データが得られたらあとから追記する。提案手法の方がいいのか？同じくらいなのか？)
    + 乗算の深さをもとに、FHEのパラメータを見積もれる

## 第5章 考察

+ 研究の進捗状況
    + 従来手法と異なる方法でシグモイド関数を近似した
        + 従来手法：シグモイド関数を直接近似した
        + 提案手法：多項式補間を用いた除算の近似 $\rightarrow$ シグモイド関数の構成した
        + 従来手法はシグモイド関数を直接近似するため、$x = 0$から離れるほど近似誤差が大きくなるというデメリットがあった。これに対して、提案手法は指数関数や除算といった演算を近似して求めているため、いずれの$x$でもシグモイド関数の値を求めることが出来る。
    + 提案手法を用いたシグモイド関数の推論精度
        + (結果が固まり次第まとめる)
+ 研究によって新たに得られた情報
    + 指数関数
        + 高い精度で指数関数を近似できた(結果次第で変動)
        + 先行研究で述べられていた手法を再度実現できた
    + 除算
        + 高い精度で指数関数を近似できた(結果次第で変動)
        + 従来の多項式補間による手法は整数を対象としていたが、今回は実数にも適用できる
            + 先行研究の例を示すこと
    + シグモイド関数
        + 入力値の範囲は$[-B, B]$で決まる
        + 提案手法の計算量が分かった
            + $O(\log p (\log p +log B))$
            + かなり乗算が深い
            + 直接近似と違って一定の範囲（例えば$[-1, 1]$）しか近似できないとかはないけど、その代わり計算量が大きい
            + 精度と計算量のトレードオフ
        + (結果が固まり次第まとめる)
+ 今後に向けて
    + 精度検証
        + 平文に対する推論精度しかわかっていない
        + 暗号データに対する評価も行う必要がある
        + ノイズ、計算誤差による精度のずれが起きる可能性がある
+ 現状の課題
    + 除算のスケーリングの算出
        + $R = a^{\lfloor \log_a x \rfloor}$ がFHEだと計算できない
    + 計算量
        + 4.3節で示したように計算量が大きいため、演算に時間がかかる
        + 演算の数も従来手法と比較して多いため、ノイズの問題が大きくなる（従来手法の計算量をオーダー記法で示す）

## 第6章 まとめ

+ 研究目的の再提示
    + シグモイド関数に必要な除算を提案し、それを用いてシグモイド関数を構成する
+ 研究の進捗状況
    + シグモイド関数に必要な除算を提案した
    + この手法でシグモイド関数を構成した
+ 懸念・弱点
    + スケーリング $R = a^{\lfloor \log_a x \rfloor}$ を計算するために復号する必要がある
+ 本研究の新規性
    + 直接近似とは異なるアプローチでシグモイド関数を構築した
    + 通常のシグモイド関数と同精度の近似が実現できた
+ 今後の課題
    + 暗号データに対する精度検証が必要
